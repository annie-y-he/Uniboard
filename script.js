keymap = {
  'a': 0,
  's': 1,
  'd': 2,
  'f': 3,
  'q': 4,
  'w': 5,
  'e': 6,
  'r': 7,
  'z': 8,
  'x': 9,
  'c': 10,
  'v': 11,
  ' ': 12,
  'm': 13,
  ',': 14,
  '.': 15,
  '/': 16,
  'u': 17,
  'i': 18,
  'o': 19,
  'p': 20,
  'j': 21,
  'k': 22,
  'l': 23,
  ';': 24,
}

alph = [
  "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",
  "à¸à¸²à¸‚à¸²à¸ƒà¸²à¸„à¸²à¸…à¸²à¸†à¸²à¸‡à¸²à¸ˆà¸²à¸‰à¸²à¸Šà¸²à¸‹à¸²à¸Œà¸²à¸à¸²à¸Žà¸²à¸à¸²à¸à¸²à¸‘à¸²à¸’à¸²à¸“à¸²à¸”à¸²à¸•à¸²à¸–à¸²à¸—à¸²à¸˜à¸²à¸™à¸²à¸šà¸²à¸›à¸²à¸œà¸²à¸à¸²à¸žà¸²à¸Ÿà¸²à¸ à¸²à¸¡à¸²à¸¢à¸²à¸£à¸²à¸¥à¸²à¸§à¸²à¸¨à¸²à¸©à¸²à¸ªà¸²à¸«à¸²à¸¬à¸²à¸­à¸²à¸®à¸²",
  "çš„æˆ‘ä½ æ˜¯äº†ä¸åœ¨ä»–æœ‰è¿™ä¸ªä¸Šä»¬æ¥åˆ°æ—¶å¤§åœ°ä¸ºå­ä¸­ä½ è¯´ç”Ÿå›½å¹´ç€å°±é‚£å’Œè¦å¥¹å‡ºä¹Ÿå¾—é‡ŒåŽè‡ªä»¥ä¼šå®¶å¯ä¸‹è€Œè¿‡å¤©åŽ»èƒ½å¯¹å°å¤šç„¶äºŽå¿ƒå­¦ä¹‹éƒ½å¥½çœ‹èµ·å‘æˆä¸šå¤–ç›¸",
  "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZzÃ„Ã¤Ã–Ã¶ÃœÃ¼áºžÃŸ"
]

sentence = [
  "With this keyboard, you can type any Unicode character instantly. - English",
  "Con este teclado, puedes teclear cualquier carÃ¡cter Unicode al instante. - Spanish",
  "Avec ce clavier, vous pouvez taper n'importe quel caractÃ¨re Unicode instantanÃ©ment. - French",
  "ã“ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ä½¿ãˆã°ã€ä»»æ„ã®Unicodeæ–‡å­—ã‚’å³åº§ã«å…¥åŠ›ã§ãã¾ã™ã€‚- Japanese",
  "Mit dieser Tastatur kÃ¶nnen Sie sofort jedes Unicode-Zeichen eingeben. - German",
  "à¤‡à¤¸ à¤•à¥€à¤¬à¥‹à¤°à¥à¤¡ à¤•à¥‡ à¤¸à¤¾à¤¥, à¤†à¤ª à¤¤à¥à¤°à¤‚à¤¤ à¤•à¥‹à¤ˆ à¤­à¥€ à¤¯à¥‚à¤¨à¤¿à¤•à¥‹à¤¡ à¤šà¤°à¤¿à¤¤à¥à¤° à¤Ÿà¤¾à¤‡à¤ª à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ - Hindi",
  "Com este teclado, vocÃª pode digitar qualquer caractere Unicode instantaneamente. - Portuguese",
  "Ð¡ ÑÑ‚Ð¾Ð¹ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð¾Ð¹ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾ Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð»ÑŽÐ±Ð¾Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð» Unicode. - Russian",
  "Con questa tastiera, puoi digitare qualsiasi carattere Unicode all'istante. - Italian",
  "ä½¿ç”¨è¿™ä¸ªé”®ç›˜ï¼Œä½ å¯ä»¥ç«‹å³è¾“å…¥ä»»ä½•Unicodeå­—ç¬¦ã€‚- Chinese",
  "Bu klavye ile herhangi bir Unicode karakterini anÄ±nda yazabilirsiniz. - Turkish",
  "Med detta tangentbord kan du skriva in vilket Unicode-tecken som helst pÃ¥ ett Ã¶gonblick. - Swedish",
  "Met dit toetsenbord kunt u direct elk Unicode-teken typen. - Dutch",
  "S touto klÃ¡vesnicÃ­ mÅ¯Å¾ete okamÅ¾itÄ› psÃ¡t jakÃ½koli znak Unicode. - Czech",
  "Med dette tastaturet kan du umiddelbart skrive hvilken som helst Unicode-tegn. - Norwegian",
  "Na tej klawiaturze moÅ¼esz natychmiast wpisaÄ‡ dowolny znak Unicode. - Polish",
  "Selle klaviatuuriga saate kohe sisestada Ã¼kskÃµik millise Unicode tÃ¤hemÃ¤rgi. - Estonian",
  "à¸”à¹‰à¸§à¸¢à¸„à¸µà¸¢à¹Œà¸šà¸­à¸£à¹Œà¸”à¸™à¸µà¹‰ à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¸žà¸´à¸¡à¸žà¹Œà¸­à¸±à¸à¸‚à¸£à¸° Unicode à¹ƒà¸”à¸à¹‡à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ - Thai",
  "ÎœÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î¹Î¿, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³Î®ÏƒÎµÏ„Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ± Unicode Î±Î¼Î­ÏƒÏ‰Ï‚. - Greek",
  "Ezzel a billentyÅ±zettel azonnal beÃ­rhat bÃ¡rmely Unicode karaktert. - Hungarian",
  "ì´ í‚¤ë³´ë“œë¡œëŠ” ëª¨ë“  ìœ ë‹ˆì½”ë“œ ë¬¸ìžë¥¼ ì¦‰ì‹œ ìž…ë ¥í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. - Korean",
  "Ø¨Ø§ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯ØŒ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ø³Ø±Ø¹Øª Ù‡Ø± Ú©Ø§Ø±Ø§Ú©ØªØ± ÛŒÙˆÙ†ÛŒÚ©Ø¯ÛŒ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯. - Persian",
  "à¤¯à¤¸ à¤•à¤¿à¤¬à¥‹à¤°à¥à¤¡à¤®à¤¾ à¤¤à¤ªà¤¾à¤ˆà¤‚ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤•à¥à¤¨à¥ˆ à¤ªà¤¨à¤¿ à¤¯à¥à¤¨à¤¿à¤•à¥‹à¤¡ à¤…à¤•à¥à¤·à¤° à¤Ÿà¤¾à¤‡à¤ª à¤—à¤°à¥à¤¨ à¤¸à¤•à¥à¤¨à¥à¤¹à¥à¤¨à¥à¤›à¥¤ - Nepali",
  "áƒáƒ› áƒ™áƒšáƒáƒ•áƒ˜áƒáƒ¢áƒ£áƒ áƒáƒ–áƒ” áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ›áƒ§áƒ˜áƒ¡áƒ˜áƒ”áƒ áƒáƒ“ áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒœáƒ”áƒ‘áƒ˜áƒ¡áƒ›áƒ˜áƒ”áƒ áƒ˜ áƒ£áƒœáƒ˜áƒ™áƒáƒ“áƒ˜áƒ¡ áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ. - Georgian",
  "à®‡à®¨à¯à®¤ à®•à¯€à®ªà¯‹à®°à¯à®Ÿà¯à®Ÿà®©à¯, à®¨à¯€à®™à¯à®•à®³à¯ à®Žà®¨à¯à®¤ à®¯à¯à®©à®¿à®•à¯‹à®Ÿà¯ à®Žà®´à¯à®¤à¯à®¤à¯ˆà®¯à¯à®®à¯ à®‰à®Ÿà®©à®Ÿà®¿à®¯à®¾à®• à®¤à®Ÿà¯à®Ÿà®šà¯à®šà¯ à®šà¯†à®¯à¯à®¯ à®®à¯à®Ÿà®¿à®¯à¯à®®à¯. - Tamil",
  "à¦à¦‡ à¦•à§€à¦¬à§‹à¦°à§à¦¡à§‡à¦° à¦®à¦¾à¦§à§à¦¯à¦®à§‡ à¦†à¦ªà¦¨à¦¿ à¦®à§à¦¹à§‚à¦°à§à¦¤à§‡ à¦¯à§‡à¦•à§‹à¦¨à§‹ à¦‡à¦‰à¦¨à¦¿à¦•à§‹à¦¡ à¦…à¦•à§à¦·à¦° à¦Ÿà¦¾à¦‡à¦ª à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨à¥¤ - Bengali",
  "Ù‡Ø°Ø§ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªØ§Ø¨Ø© Ø£ÙŠ Ø­Ø±Ù ÙŠÙˆÙ†ÙŠÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±. - Arabic",
  "à¨‡à¨¸ à¨•à©€à¨¬à©‹à¨°à¨¡ à¨¨à¨¾à¨², à¨¤à©à¨¸à©€à¨‚ à¨•à©‹à¨ˆ à¨µà©€ à¨¯à©‚à¨¨à©€à¨•à©‹à¨¡ à¨…à©±à¨–à¨° à¨¤à©à¨°à©°à¨¤ à¨Ÿà¨¾à¨ˆà¨ª à¨•à¨° à¨¸à¨•à¨¦à©‡ à¨¹à©‹à¥¤ - Punjabi",
  "áž‡áž¶áž˜áž½áž™áž€áŸ’ážáž¶ážšáž…áž»áž…áž“áŸáŸ‡ áž¢áŸ’áž“áž€áž¢áž¶áž…ážœáž¶áž™áž¢áž€áŸ’ážŸážšáž™áž¼áž“áž¸áž€áž¼ážŠážŽáž¶áž˜áž½áž™áž—áŸ’áž›áž¶áž˜áŸ—áŸ” - Khmer",
  "×¢× ×ž×§×œ×“×ª ×–×•, ×ª×•×›×œ ×œ×”×§×œ×™×“ ×›×œ ×ª×• ×™×•× ×™×§×•×“ ×ž×™×“. - Hebrew",
  "ðŸ‘©â€ðŸ’»ðŸ‘‰âŒ¨ï¸ðŸŒŸðŸ” ðŸ”¡ðŸ”¢ðŸŒðŸ’«ðŸš€â©",
  "(ï¾‰^_^)ï¾‰[xxxx x xxxx]áž“áž¸à¸­à¸±é”®ã"
]

Promise.all([
  fetch('https://annie-he.com/files/mapping3.json').then(response => response.json()),
  fetch('https://annie-he.com/files/mapping2.json').then(response => response.json())
])
.then(([data1, data2]) => {
  down = new Array(25).fill("0");
  board = document.querySelector("#board")
  demoText = document.querySelector("#demo-text")
  demoFixed = document.querySelector("#demo-fixed")
  demo = document.querySelector("#demo")
  startButton = document.querySelector("#start")
  alphButton = document.querySelector("#alph")
  sentenceButton = document.querySelector("#sentence")
  highlight = document.querySelector("#highlight")
  text = ""
  display = document.querySelector("#char")
  ready = document.querySelector("#ready")

  ready.textContent = "Ready!!!"

  startButton.addEventListener("click", () => {
    if (startButton.textContent == "start") {
      text = demoText.value
      startButton.textContent = "edit"
      try {
        demo.textContent = data1[text.codePointAt(0).toString()];
      } catch (e) {
        demo.textContent = data1[0];
      }
      demoFixed.children[0].textContent = ""
      demoFixed.children[1].textContent = text
      demoFixed.children[0].style.backgroundColor = "powderblue"
      demoFixed.children[1].textContent = text
      demoText.style.display = "none"
      demoFixed.style.display = "block"
    } else {
      startButton.textContent = "start"
      demoText.style.display = "block"
      demoFixed.style.display = "none"
    }
  });

  alphButton.addEventListener("click", () => {
    demoText.value = alph[Math.floor(Math.random() * alph.length)];
  });
  sentenceButton.addEventListener("click", () => {
    demoText.value = sentence[Math.floor(Math.random() * sentence.length)];
  });

  document.addEventListener("keydown", (event) => {
    if (event.target.tagName == 'BUTTON') {
      event.preventDefault();
    }
    down[keymap[event.key]] = "1"
    board.textContent = data1[data2[down.join("")].toString()]
    if (board.textContent == demo.textContent) {
      sliceLen = 1
      if (demoFixed.children[1].textContent.charCodeAt(0) >= 0xD800 && demoFixed.children[1].textContent.charCodeAt(0) <= 0xDBFF) {
        sliceLen = 2
      }
      console.log(sliceLen)
      demoFixed.children[0].textContent += demoFixed.children[1].textContent[0]
      demoFixed.children[1].textContent = demoFixed.children[1].textContent.slice(sliceLen)
      if (demoFixed.children[1].textContent == "") {
        demoFixed.children[0].textContent = ""
        demoFixed.children[1].textContent = text
      }
      demo.textContent = data1[demoFixed.children[1].textContent.codePointAt(0).toString()];
    }
    display.textContent = String.fromCodePoint(data2[down.join("")])
  });

  document.addEventListener("keyup", (event) => {
    down[keymap[event.key]] = "0"
    board.textContent = data1[data2[down.join("")].toString()]
    display.textContent = String.fromCodePoint(data2[down.join("")])
  });
})
.catch(error => {
  console.error("Failed to fetch:", error);
});
